---
description: 작업 생성 후 spec.md, plan.md 및 tasks.md 전반에 걸친 비파괴적 교차 아티팩트 일관성 및 품질 분석을 수행합니다.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks
  ps: scripts/powershell/check-prerequisites.ps1 -Json -RequireTasks -IncludeTasks
---

## 사용자 입력

```text
$ARGUMENTS
```

비어있지 않은 경우 진행하기 전에 사용자 입력을 **반드시** 고려해야 합니다.

## 목표

구현 전에 세 가지 핵심 아티팩트(`spec.md`, `plan.md`, `tasks.md`) 전반의 불일치, 중복, 모호성 및 불충분하게 명시된 항목을 식별합니다. 이 명령어는 `/tasks`가 완전한 `tasks.md`를 성공적으로 생성한 후에만 실행되어야 합니다.

## 운영 제약사항

**엄격한 읽기 전용**: 어떤 파일도 **수정하지 마세요**. 구조화된 분석 보고서를 출력하세요. 선택적 수정 계획을 제공하세요 (사용자가 후속 편집 명령어를 수동으로 호출하기 전에 명시적으로 승인해야 합니다).

**헌장 권한**: 프로젝트 헌장(`/memory/constitution.md`)은 이 분석 범위 내에서 **협상 불가**입니다. 헌장 충돌은 자동으로 CRITICAL이며 명세, 계획 또는 작업의 조정이 필요합니다—원칙의 희석, 재해석 또는 묵시적 무시가 아닙니다. 원칙 자체가 변경되어야 하는 경우 `/analyze` 외부의 별도 명시적 헌장 업데이트에서 발생해야 합니다.

## 실행 단계

### 1. 분석 컨텍스트 초기화

리포지토리 루트에서 `{SCRIPT}`를 한 번 실행하고 FEATURE_DIR 및 AVAILABLE_DOCS에 대한 JSON을 파싱하세요. 절대 경로 파생:

- SPEC = FEATURE_DIR/spec.md
- PLAN = FEATURE_DIR/plan.md
- TASKS = FEATURE_DIR/tasks.md

필요한 파일이 없으면 오류 메시지와 함께 중단하세요 (사용자에게 누락된 전제조건 명령어를 실행하도록 지시).
"I'm Groot"와 같은 인자의 작은따옴표는 이스케이프 구문을 사용하세요: 예 'I'\''m Groot' (또는 가능하면 큰따옴표 사용: "I'm Groot").

### 2. 아티팩트 로드 (점진적 공개)

각 아티팩트에서 최소한 필요한 컨텍스트만 로드:

**spec.md에서:**

- 개요/컨텍스트
- 기능 요구사항
- 비기능 요구사항
- 사용자 스토리
- 엣지 케이스 (있는 경우)

**plan.md에서:**

- 아키텍처/스택 선택
- 데이터 모델 참조
- 페이즈
- 기술적 제약사항

**tasks.md에서:**

- 작업 ID
- 설명
- 페이즈 그룹화
- 병렬 마커 [P]
- 참조된 파일 경로

**헌장에서:**

- 원칙 검증을 위해 `/memory/constitution.md` 로드

### 3. 의미 모델 구축

내부 표현 생성 (출력에 원시 아티팩트 포함하지 마세요):

- **요구사항 목록**: 안정적인 키가 있는 각 기능 + 비기능 요구사항 (명령형 구문 기반으로 슬러그 파생; 예: "User can upload file" → `user-can-upload-file`)
- **사용자 스토리/액션 목록**: 수락 기준이 있는 개별 사용자 액션
- **작업 커버리지 매핑**: 각 작업을 하나 이상의 요구사항 또는 스토리에 매핑 (키워드 / ID 또는 주요 구문과 같은 명시적 참조 패턴으로 추론)
- **헌장 규칙 세트**: 원칙 이름 및 MUST/SHOULD 규범적 진술 추출

### 4. 감지 패스 (토큰 효율적 분석)

고신호 발견사항에 집중. 총 50개 발견사항으로 제한; 나머지는 오버플로우 요약에 집계.

#### A. 중복 감지

- 거의 중복된 요구사항 식별
- 통합을 위해 품질이 낮은 표현 표시

#### B. 모호성 감지

- 측정 가능한 기준이 없는 모호한 형용사 플래그 (fast, scalable, secure, intuitive, robust)
- 미해결 플레이스홀더 플래그 (TODO, TKTK, ???, `<placeholder>` 등)

#### C. 불충분한 명세

- 동사는 있지만 객체 또는 측정 가능한 결과가 없는 요구사항
- 수락 기준 정렬이 없는 사용자 스토리
- 명세/계획에 정의되지 않은 파일 또는 컴포넌트를 참조하는 작업

#### D. 헌장 정렬

- MUST 원칙과 충돌하는 모든 요구사항 또는 계획 요소
- 헌장에서 누락된 필수 섹션 또는 품질 게이트

#### E. 커버리지 갭

- 관련 작업이 없는 요구사항
- 매핑된 요구사항/스토리가 없는 작업
- 작업에 반영되지 않은 비기능 요구사항 (예: 성능, 보안)

#### F. 불일치

- 용어 드리프트 (파일 전반에 걸쳐 동일한 개념이 다르게 명명됨)
- 계획에 참조되지만 명세에 없는 데이터 엔티티 (또는 그 반대)
- 작업 순서 모순 (예: 의존성 노트 없이 기초 설정 작업 전에 통합 작업)
- 충돌하는 요구사항 (예: 하나는 Next.js를 요구하고 다른 하나는 Vue를 지정)

### 5. 심각도 할당

발견사항 우선순위 지정을 위해 이 휴리스틱 사용:

- **CRITICAL**: 헌장 MUST 위반, 핵심 명세 아티팩트 누락 또는 기본 기능을 차단하는 커버리지가 없는 요구사항
- **HIGH**: 중복 또는 충돌하는 요구사항, 모호한 보안/성능 속성, 테스트 불가능한 수락 기준
- **MEDIUM**: 용어 드리프트, 누락된 비기능 작업 커버리지, 불충분하게 명시된 엣지 케이스
- **LOW**: 스타일/표현 개선, 실행 순서에 영향을 미치지 않는 사소한 중복

### 6. 간결한 분석 보고서 생성

다음 구조로 마크다운 보고서 출력 (파일 쓰기 없음):

## 명세 분석 보고서

| ID | 카테고리 | 심각도 | 위치 | 요약 | 권장사항 |
|----|----------|----------|-------------|---------|----------------|
| A1 | 중복 | HIGH | spec.md:L120-134 | 두 개의 유사한 요구사항 ... | 표현 병합; 더 명확한 버전 유지 |

(발견사항당 한 행 추가; 카테고리 이니셜 접두사로 안정적인 ID 생성.)

**커버리지 요약 테이블:**

| 요구사항 키 | 작업 있음? | 작업 ID | 참고사항 |
|-----------------|-----------|----------|-------|

**헌장 정렬 문제:** (있는 경우)

**매핑되지 않은 작업:** (있는 경우)

**메트릭:**

- 총 요구사항
- 총 작업
- 커버리지 % (>=1 작업이 있는 요구사항)
- 모호성 개수
- 중복 개수
- 중요 문제 개수

### 7. 다음 액션 제공

보고서 끝에 간결한 다음 액션 블록 출력:

- CRITICAL 문제가 있으면: `/implement` 전에 해결 권장
- LOW/MEDIUM만 있으면: 사용자가 진행 가능하지만 개선 제안 제공
- 명시적 명령어 제안 제공: 예: "개선과 함께 /specify 실행", "아키텍처 조정을 위해 /plan 실행", "'performance-metrics'에 대한 커버리지를 추가하기 위해 tasks.md를 수동으로 편집"

### 8. 수정 제공

사용자에게 질문: "상위 N개 문제에 대한 구체적인 수정 편집을 제안해드릴까요?" (자동으로 적용하지 마세요.)

## 운영 원칙

### 컨텍스트 효율성

- **최소 고신호 토큰**: 포괄적인 문서가 아닌 실행 가능한 발견사항에 집중
- **점진적 공개**: 아티팩트를 점진적으로 로드; 모든 콘텐츠를 분석에 덤프하지 마세요
- **토큰 효율적 출력**: 발견사항 테이블을 50행으로 제한; 오버플로우 요약
- **결정론적 결과**: 변경 없이 재실행하면 일관된 ID와 개수 생성

### 분석 가이드라인

- **파일 수정 절대 금지** (읽기 전용 분석)
- **누락된 섹션 환각 금지** (없으면 정확하게 보고)
- **헌장 위반 우선순위 지정** (항상 CRITICAL)
- **포괄적인 규칙보다 예시 사용** (일반 패턴이 아닌 구체적인 인스턴스 인용)
- **제로 문제 우아하게 보고** (커버리지 통계와 함께 성공 보고서 출력)

## 컨텍스트

{ARGS}
